{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/TIM/Desktop/cs/vue3/uniMyspace/校园能手2/user/info/info.vue?6f7a","webpack:///C:/Users/TIM/Desktop/cs/vue3/uniMyspace/校园能手2/user/info/info.vue?d1e0","webpack:///C:/Users/TIM/Desktop/cs/vue3/uniMyspace/校园能手2/user/info/info.vue?7f0e","webpack:///C:/Users/TIM/Desktop/cs/vue3/uniMyspace/校园能手2/user/info/info.vue?bb29","uni-app:///user/info/info.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","auth","data","actionlist","text","color","fontSize","actionshow","actioninfoi","friend","uid","SystemInfo","navbar","top","uinfo","show","list","sxlist","name","sxcurrent","contList","page","limit","load","disList","computed","userinfo","hasLogin","onShow","onLoad","onPageScroll","onPullDownRefresh","uni","title","onReachBottom","methods","setUserInfo","sxchange","getContent","db","where","status","field","orderBy","skip","get","content","showCancel","getDiscover","click","count","success","uniCloud","filePath","cloudPath","onUploadProgress","progressEvent","images","funct","imgs","update","backgroundImage","icon","that","fail","complete","url","getuserinfo","token","editfriend","collection","friend_id","remove","add","getuserinfouid","postdeta","groupdeta","getfriendinfo","getOne","login","actionclick","_id","then","console","share"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AACoL;AACpL,gBAAgB,qLAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,mNAEN;AACP,KAAK;AACL;AACA,aAAa,mNAEN;AACP,KAAK;AACL;AACA,aAAa,uMAEN;AACP,KAAK;AACL;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,aAAa,qRAEN;AACP,KAAK;AACL;AACA,aAAa,oSAEN;AACP,KAAK;AACL;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACzGA;AAAA;AAAA;AAAA;AAAsrB,CAAgB,spBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;AC0N1sB;AAGA;AAAA;AACA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAEA;EACAC;IACAC;EACA;EACAC;IACA;MACAC,aACA;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAZ;MACA;QACAA;MACA;MACAa;QACAC;MACA;QACAA;MACA;MACAC;MACAC;QACAC;QACAC;QACAN;QACAO;MACA;MACAC;QACAH;QACAC;QACAN;QACAO;MACA;IACA;EACA;EACAE,4BACA;IACAC;IACAC;EACA,GACA;EACAC,2BAEA;EACAC;IACA;IAEA;MACA;MACA;MACA;QACA;MACA;IACA;MACA;IACA;IACA;MACA;IACA;EACA;EACAC;IACA;MACA;MACA;IACA;MACA;MACA;IACA;EACA;EACAC;IACAC;MACAC;IACA;IACA;MACA;MACA;MACA;MACA;IACA;MACA;MACA;MACA;MACA;IACA;EACA;EACAC;IACA;MACA;QACA;QACA;QACA;MACA;IACA;MACA;QACA;QACA;QACA;MACA;IACA;EACA;EACAC,yCACA;IACAC;EACA;IACAC;MACA;MACA;QACA;UACA;YACA;UACA;QACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACAC,8EACAC;QACAC;QACA;MACA,GACAC,MACA,kKACA,CACAC,4BACAC,WACAtB,2BACAuB;QACA;QACA;UACA;QACA;UACA;QACA;QACA;UACA;QACA;MACA;QACAb;UACAc;UACAC;QACA;MACA;QACAf;MACA;IACA;IACAgB;MAAA;MACA;MACAT,+BACAC;QACAC;QACA/B;MACA,GACAgC,MACA,kCACA,CACAC,0CACAC,WACAtB,0BACAuB;QACA;QACA;UACA;QACA;UACA;QACA;QACA;UACA;QACA;MACA;QACAb;UACAc;UACAC;QACA;MACA;QACAf;MACA;IACA;IACAiB;MACA;QACA;QACAjB;UACAkB;UACAC;YACA;cACA;cACAC;gBACAC;gBACAC;gBACAC;kBACA,kCACAC,iDACA;gBACA;gBACAL;kBACAnB;oBACAC;kBACA;kBACA;kBACAwB;kBACAL;oBACAlC;oBACAhB;sBACAwD;sBACAC;oBACA;kBACA;oBACA3B;oBACA;sBACAO,8BACAC,uBACAoB;wBACAC;sBACA;wBACA7B;0BACA8B;0BACA7B;0BACAkB;4BACAY;8BACAF;4BACA;0BACA;wBACA;sBACA;wBACA7B;0BACAc,wBACA;0BACAC;wBACA;sBACA,wBAEA;oBACA;sBACAf;wBACAc,gCACA;wBACAC;sBACA;oBACA;kBACA;oBACAf;sBACAc;sBACAC;oBACA;kBACA;gBACA;gBACAiB;kBACAhC;oBACAc;oBACAC;kBACA;gBACA;gBACAkB;cACA;YACA;UACA;QACA;MACA;QACAjC;UACAkC;QACA;MACA;IACA;IACAC;MACA;MACAf;QACAlC;QACAhB;UACAwD;UACAU;QACA;QACAjB;UACA;YACAnB;cACA8B;cACA7B;YACA;YACA8B;UACA;YACA/B;YACA+B;UACA;QACA;MACA;IACA;IACAM;MACA;QACA;UACA9B,wBACA+B,0BACA9B;YACA9B;YACA6D;UACA,GACAC;UACA;QACA;UACAjC,wBACA+B,0BACAG;YACAF;UACA;UACA;QACA;MACA;QACA;MACA;IACA;IACAG;MACA;MACAtB;QACAlC;QACAhB;UACAwD;UACAhD;QACA;QACAyC;UACA;YACAnB;cACA8B;cACA7B;YACA;UACA;YACA8B;UACA;QACA;MACA;IACA;IACAY;MACA3C;QACAkC;MACA;IACA;IACAU;MACA5C;QACAkC;MACA;IACA;IACAW;MAAA;MACAtC,6BACAC;QACA9B;QACA6D;MACA,GACA1B;QACAiC;MACA;QACA;QACA;UACA;QACA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;MAAA,CACA,uBAEA;IACA;IACAC;MAEA;IAEA;IACAC;MACA;MACA;QACAhD;UACAC;UACAa;UACAK;YACA;cACAZ,uCACAC;gBACAyC;gBACAvE;cACA,GACA8D,SACAU;gBACAlD;kBACAC;gBACA;gBACA8B;gBACAA;gBACAA;gBACAA;cACA;gBACA/B;kBACAc;kBACAC;gBACA;cACA,wBAEA;YACA;cACAoC;YACA;UACA;QACA;MACA;QACAnD;UACA8B;UACA7B;QACA;MACA;IACA;IACAmD;MACA;MACA;IACA;EAAA;AAEA;AAAA,2B","file":"user/info/info.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './user/info/info.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./info.vue?vue&type=template&id=97e5c88e&\"\nvar renderjs\nimport script from \"./info.vue?vue&type=script&lang=js&\"\nexport * from \"./info.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"user/info/info.vue\"\nexport default component.exports","export * from \"-!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./info.vue?vue&type=template&id=97e5c88e&\"","var components\ntry {\n  components = {\n    uNavbar: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-navbar/u-navbar\" */ \"@/uview-ui/components/u-navbar/u-navbar.vue\"\n      )\n    },\n    uSticky: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-sticky/u-sticky\" */ \"@/uview-ui/components/u-sticky/u-sticky.vue\"\n      )\n    },\n    uTabs: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-tabs/u-tabs\" */ \"@/uview-ui/components/u-tabs/u-tabs.vue\"\n      )\n    },\n    uniList: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-list/components/uni-list/uni-list\" */ \"@/uni_modules/uni-list/components/uni-list/uni-list.vue\"\n      )\n    },\n    uniListItem: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-list/components/uni-list-item/uni-list-item\" */ \"@/uni_modules/uni-list/components/uni-list-item/uni-list-item.vue\"\n      )\n    },\n    uniLoadMore: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-load-more/components/uni-load-more/uni-load-more\" */ \"@/uni_modules/uni-load-more/components/uni-load-more/uni-load-more.vue\"\n      )\n    },\n    uActionSheet: function () {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-action-sheet/u-action-sheet\" */ \"@/uview-ui/components/u-action-sheet/u-action-sheet.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 =\n    _vm.sxcurrent == 0\n      ? _vm.__map(_vm.contList.list, function (res, index) {\n          var $orig = _vm.__get_orig(res)\n          var g0 = res.school_id.length\n          var g1 = _vm.$u.timeFormat(res.create_date, \"yyyy-mm-dd hh:MM:ss\")\n          var g2 = res.images.length\n          var g3 = res.avatar && res.avatar.length\n          return {\n            $orig: $orig,\n            g0: g0,\n            g1: g1,\n            g2: g2,\n            g3: g3,\n          }\n        })\n      : null\n  var l1 =\n    _vm.sxcurrent == 1\n      ? _vm.__map(_vm.disList.list, function (res, index) {\n          var $orig = _vm.__get_orig(res)\n          var g4 = !res.cover ? res.name.slice(0, 1) : null\n          return {\n            $orig: $orig,\n            g4: g4,\n          }\n        })\n      : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.show = true\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./info.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../develop/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./info.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<u-navbar v-if=\"navbar\" :title=\"uinfo.nickName || userinfo.nickName\"></u-navbar>\r\n\t\t<view class=\"grid col-1\" v-if=\"userinfo._id!=uid\">\r\n\t\t\t<view class=\"bg-img padding-top-xl flex align-end\" style=\"height: 540upx;background-repeat: no-repeat;\"\r\n\t\t\t\t:style=\"[{ backgroundImage:'url(' + uinfo.backgroundImage + ')' }]\">\r\n\t\t\t\t<view class=\"bg-shadeBottomb padding padding-top flex-sub\">\r\n\t\t\t\t\t<view class=\"flex justify-between align-center\">\r\n\t\t\t\t\t\t<view class=\"cu-avatar xl round\" style=\"border: 4rpx solid #FFFFFF;\"\r\n\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + uinfo.avatar+ ')' }]\">\r\n\t\t\t\t\t\t\t<view class=\"cu-tag badge\"\r\n\t\t\t\t\t\t\t\t:class=\"uinfo.gender==1?'cuIcon-female bg-pink':'cuIcon-male bg-blue'\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t<button @click=\"editfriend\" class=\"cu-btn round\" :class=\"friend ? 'bg-blue light' : 'bg-blue'\">{{friend ? '已关注' :'关注'}}</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top\" style=\"font-size: 34rpx;font-weight: 500;\">\r\n\t\t\t\t\t\t{{uinfo.nickName}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top-sm\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t{{uinfo.introduce ? uinfo.introduce : '暂无个人简介'}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top-sm\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t<!-- <view class=\"cu-avatar xl round\" style=\"border: 4rpx solid #FFFFFF;\" :style=\"[{ backgroundImage:'url(' + userinfo.avatar+ ')' }]\">\r\n\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t{{uinfo.school ? uinfo.school : '未绑定学校'}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- <view class=\"flex justify-between margin-top\">\r\n\t\t\t\t\t\t<view class=\"flex flex-sub justify-between\">\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1获赞\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1关注\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1粉丝\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"flex-sub\"></view>\r\n\t\t\t\t\t</view> -->\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"grid col-1\" v-else>\r\n\t\t\t<view class=\"bg-img padding-top-xl flex align-end\" style=\"height: 540upx;background-repeat: no-repeat;\"\r\n\t\t\t\t:style=\"[{ backgroundImage:'url(' + userinfo.backgroundImage + ')' }]\">\r\n\t\t\t\t<view class=\"bg-shadeBottomb padding padding-top flex-sub\">\r\n\t\t\t\t\t<view class=\"flex justify-between align-center\">\r\n\t\t\t\t\t\t<view class=\"cu-avatar xl round\" style=\"border: 4rpx solid #FFFFFF;\"\r\n\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + userinfo.avatar+ ')' }]\">\r\n\t\t\t\t\t\t\t<view class=\"cu-tag badge\"\r\n\t\t\t\t\t\t\t\t:class=\"userinfo.gender==1?'cuIcon-female bg-pink':'cuIcon-male bg-blue'\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"\" v-if=\"userinfo._id==uid\">\r\n\t\t\t\t\t\t\t<button class=\"cu-btn round\" @click=\"show=true\">编辑资料</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"\" v-else>\r\n\t\t\t\t\t\t\t<button class=\"cu-btn round bg-blue\">关 注</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top\" style=\"font-size: 34rpx;font-weight: 500;\">\r\n\t\t\t\t\t\t{{userinfo.nickName}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top-sm\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t{{userinfo.introduce ? userinfo.introduce : '暂无个人简介'}}\r\n\t\t\t\t\t\t<text class=\"cuIcon-edit margin-left-sm\"></text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"margin-top-sm\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t<!-- <view class=\"cu-avatar xl round\" style=\"border: 4rpx solid #FFFFFF;\" :style=\"[{ backgroundImage:'url(' + userinfo.avatar+ ')' }]\">\r\n\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t{{userinfo.school ? userinfo.school : '请绑定学校'}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- <view class=\"flex justify-between margin-top\">\r\n\t\t\t\t\t\t<view class=\"flex flex-sub justify-between\">\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1获赞\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1关注\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t1粉丝\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"flex-sub\"></view>\r\n\t\t\t\t\t</view> -->\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"\">\r\n\t\t\t<!-- #ifdef MP-WEIXIN -->\r\n\t\t\t<u-sticky :offset-top=\"88+SystemInfo.statusBarHeight * 2\">\r\n\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t<u-tabs :list=\"sxlist\" :show-bar=\"false\" :is-scroll=\"false\" :current=\"sxcurrent\" @change=\"sxchange\"\r\n\t\t\t\t\t\tbar-width=\"90\" active-color=\"#0081ff\"></u-tabs>\r\n\t\t\t\t</view>\r\n\t\t\t</u-sticky>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifndef MP-WEIXIN -->\r\n\t\t\t<u-sticky>\r\n\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t<u-tabs :list=\"sxlist\" :show-bar=\"false\" :is-scroll=\"false\" :current=\"sxcurrent\" @change=\"sxchange\"\r\n\t\t\t\t\t\tbar-width=\"90\" active-color=\"#0081ff\"></u-tabs>\r\n\t\t\t\t</view>\r\n\t\t\t</u-sticky>\r\n\t\t\t<!-- #endif -->\r\n\t\t</view>\r\n\t\t<view class=\"\">\r\n\t\t\t<uni-list v-if=\"sxcurrent==0\">\r\n\t\t\t\t<uni-list-item :border=\"false\" v-for=\"(res,index) in contList.list\" :key=\"index\">\r\n\t\t\t\t\t<view slot=\"body\" class=\"bg-white padding\"\r\n\t\t\t\t\t\tstyle=\"margin: 10rpx 14rpx;width: 100%;border-radius: 18rpx;\">\r\n\t\t\t\t\t\t<view class=\"flex justify-between align-center \">\r\n\t\t\t\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"cu-avatar  round\"\r\n\t\t\t\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + res.uid[0].avatar+ ')' }]\"></view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"margin-left-sm\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"\" style=\"font-weight: bold;font-size: 24rpx;\">\r\n\t\t\t\t\t\t\t\t\t\t{{res.uid[0].nickName}}\r\n\t\t\t\t\t\t\t\t\t\t<view v-if=\"res.school_id.length\" class=\"cu-avatar sm round shadow-warp\"\r\n\t\t\t\t\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + res.school_id[0].logo+ ')' }]\"></view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"\" style=\"font-size: 20rpx;color: #909399;\">\r\n\t\t\t\t\t\t\t\t\t\t<text\r\n\t\t\t\t\t\t\t\t\t\t\tstyle=\"font-size: 24rpx;\">{{$u.timeFormat(res.create_date, 'yyyy-mm-dd hh:MM:ss')}}</text>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view v-if=\"hasLogin && uid==userinfo._id\" class=\"\" @click=\"share(res)\">\r\n\t\t\t\t\t\t\t\t<text class=\"cuIcon-more\"></text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"\" @click=\"postdeta(res._id)\">\r\n\t\t\t\t\t\t\t<view class=\"padding-top-sm\" style=\"font-size: 26rpx;\">\r\n\t\t\t\t\t\t\t\t{{res.content}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"grid col-3 padding-top-sm\" v-if=\"res.images.length\">\r\n\t\t\t\t\t\t\t\t<view style=\"padding: 6rpx;\" v-for=\"(item,index) in res.images\" :key=\"index\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"item.url || item\" mode=\"aspectFill\" lazy-load\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 100%;height: 200rpx;border-radius: 12rpx;\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"margin-top flex align-center\">\r\n\t\t\t\t\t\t\t<button @click=\"groupdeta(res.cid[0]._id,res.cid[0].name)\" v-if=\"res.cid[0]\"\r\n\t\t\t\t\t\t\t\tclass=\"cu-btn round bg-blue padding sm light\">\r\n\t\t\t\t\t\t\t\t#{{res.cid[0].name}}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<view v-if=\"res.avatar && res.avatar.length\" class=\"cu-avatar-group\">\r\n\t\t\t\t\t\t\t\t<view class=\"cu-avatar round sm\" v-for=\"(item,index) in res.avatar\" :key=\"index\"\r\n\t\t\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + item + ')' }]\"></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<text v-if=\"res.common_num\" class=\"text-gray\"\r\n\t\t\t\t\t\t\t\tstyle=\"font-size: 24rpx;\">已有{{res.common_num}}+人评论</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"padding-top-sm\" v-if=\"res.location\">\r\n\t\t\t\t\t\t\t<view class=\"cu-tag sm light bg-grey\" style=\"border-radius: 29rpx;\">\r\n\t\t\t\t\t\t\t\t<text class=\"cuIcon-location\"></text> {{res.location.name}}\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"flex justify-between text-gray margin-top-sm\">\r\n\t\t\t\t\t\t\t<view class=\"\" style=\"margin-right: 40rpx;\">\r\n\t\t\t\t\t\t\t\t<text class=\"cuIcon-like\" style=\"font-size: 38rpx;\"></text>\r\n\t\t\t\t\t\t\t\t{{res.collect_num ? res.collect_num : ''}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\" style=\"margin-right: 40rpx;\">\r\n\t\t\t\t\t\t\t\t<text class=\"cuIcon-mark\" style=\"font-size: 38rpx;\"></text>\r\n\t\t\t\t\t\t\t\t{{res.common_num ? res.common_num : ''}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t<text class=\"cuIcon-attention\" style=\"font-size: 38rpx;\"></text>\r\n\t\t\t\t\t\t\t\t{{res.view ? res.view : ''}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-list-item>\r\n\t\t\t</uni-list>\r\n\r\n\t\t\t<uni-list v-if=\"sxcurrent==1\" class=\"bg-white\">\r\n\t\t\t\t<uni-list-item :border=\"false\" v-for=\"(res,index) in disList.list\" :key=\"index\">\r\n\t\t\t\t\t<view slot=\"body\" style=\"width: 100%;\" class=\"padding-sm solid-bottom bg-white\">\r\n\t\t\t\t\t\t<view class=\"flex justify-between align-center\" @click=\"groupdeta(res._id,res.name)\">\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t<view v-if=\"res.cover\" class=\"cu-avatar radius\"\r\n\t\t\t\t\t\t\t\t\t:style=\"[{ backgroundImage:'url(' + res.cover+ ')' }]\"></view>\r\n\t\t\t\t\t\t\t\t<view v-else class=\"cu-avatar radius bg-green\">{{res.name.slice(0,1)}}</view>\r\n\t\t\t\t\t\t\t\t<text class=\"margin-left-sm\" style=\"font-size: 26rpx;\">#{{res.name}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"text-gray\" style=\"font-size: 24rpx;\">\r\n\t\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t\t{{res.topic_num}}话题\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t\t{{res.common_num}}评论\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-list-item>\r\n\t\t\t</uni-list>\r\n\t\t\t<uni-load-more :status=\"sxcurrent==0 ? contList.load : disList.load\"></uni-load-more>\r\n\t\t</view>\r\n\r\n\t\t<template v-if=\"uinfo==''\">\r\n\t\t\t<u-action-sheet :list=\"list\" v-model=\"show\" @click=\"click\"></u-action-sheet>\r\n\t\t</template>\r\n\r\n\t\t<u-action-sheet safe-area-inset-bottom :list=\"actionlist\" v-model=\"actionshow\" @click=\"actionclick\"></u-action-sheet>\r\n\t\t<auth ref=\"auth\"></auth>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapGetters,\r\n\t\tmapMutations\r\n\t} from 'vuex';\r\n\tconst db = uniCloud.database()\r\n\timport auth from \"@/components/auth.vue\"\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tauth\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tactionlist: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: '删除' ,\r\n\t\t\t\t\tcolor: 'red',\r\n\t\t\t\t\tfontSize: 28\r\n\t\t\t\t}],\r\n\t\t\t\tactionshow: false,\r\n\t\t\t\tactioninfoi:'',\r\n\t\t\t\tfriend: '',\r\n\t\t\t\tuid: '',\r\n\t\t\t\tSystemInfo: '',\r\n\t\t\t\tnavbar: false,\r\n\t\t\t\ttop: 320,\r\n\t\t\t\tuinfo: '',\r\n\t\t\t\tshow: false,\r\n\t\t\t\tlist: [{\r\n\t\t\t\t\ttext: '修改背景'\r\n\t\t\t\t}, {\r\n\t\t\t\t\ttext: '编辑资料'\r\n\t\t\t\t}],\r\n\t\t\t\tsxlist: [{\r\n\t\t\t\t\tname: '帖子'\r\n\t\t\t\t}, {\r\n\t\t\t\t\tname: '话题'\r\n\t\t\t\t}],\r\n\t\t\t\tsxcurrent: 0,\r\n\t\t\t\tcontList: {\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tlimit: 10,\r\n\t\t\t\t\tlist: [],\r\n\t\t\t\t\tload: 'loading',\r\n\t\t\t\t},\r\n\t\t\t\tdisList: {\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tlimit: 10,\r\n\t\t\t\t\tlist: [],\r\n\t\t\t\t\tload: 'loading',\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapGetters({\r\n\t\t\t\tuserinfo: 'user/info',\r\n\t\t\t\thasLogin: 'user/hasLogin'\r\n\t\t\t})\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\t\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tthis.SystemInfo = uni.getSystemInfoSync();\r\n\t\t\t\r\n\t\t\tif (e.uid) {\r\n\t\t\t\tthis.uid = e.uid\r\n\t\t\t\tthis.getuserinfouid()\r\n\t\t\t\tif (this.userinfo && this.uid!=this.userinfo._id) {\r\n\t\t\t\t\tthis.getfriendinfo()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.uid = this.userinfo._id\r\n\t\t\t}\r\n\t\t\tif (this.uid) {\r\n\t\t\t\tthis.getContent()\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPageScroll(e) {\r\n\t\t\tif (e.scrollTop > 95) {\r\n\t\t\t\tthis.navbar = true\r\n\t\t\t\tthis.top = 320 + 88 + (this.SystemInfo.statusBarHeight * 2)\r\n\t\t\t} else {\r\n\t\t\t\tthis.top = 320\r\n\t\t\t\tthis.navbar = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '加载中'\r\n\t\t\t});\r\n\t\t\tif (this.sxcurrent == 0) {\r\n\t\t\t\tthis.contList.list = [];\r\n\t\t\t\tthis.contList.page = 1;\r\n\t\t\t\tthis.contList.load = \"loading\";\r\n\t\t\t\tthis.getContent()\r\n\t\t\t} else {\r\n\t\t\t\tthis.disList.list = [];\r\n\t\t\t\tthis.disList.page = 1;\r\n\t\t\t\tthis.disList.load = \"loading\";\r\n\t\t\t\tthis.getDiscover()()\r\n\t\t\t}\r\n\t\t},\r\n\t\tonReachBottom() {\r\n\t\t\tif (this.sxcurrent == 0) {\r\n\t\t\t\tif (this.contList.load != \"noMore\") {\r\n\t\t\t\t\tthis.contList.load = \"loading\";\r\n\t\t\t\t\tthis.contList.page++\r\n\t\t\t\t\tthis.getContent()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.disList.load != \"noMore\") {\r\n\t\t\t\t\tthis.disList.load = \"loading\";\r\n\t\t\t\t\tthis.disList.page++\r\n\t\t\t\t\tthis.getDiscover()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations({\r\n\t\t\t\tsetUserInfo: 'user/setinfo'\r\n\t\t\t}),\r\n\t\t\tsxchange(index) {\r\n\t\t\t\tthis.sxcurrent = index;\r\n\t\t\t\tif (this.uid) {\r\n\t\t\t\t\tif (index == 0) {\r\n\t\t\t\t\t\tif (this.contList.list.length < 1) {\r\n\t\t\t\t\t\t\tthis.getContent()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.disList.list.length < 1) {\r\n\t\t\t\t\t\t\tthis.getDiscover()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetContent() {\r\n\t\t\t\tlet skip = (this.contList.page - 1) * this.contList.limit;\r\n\t\t\t\tdb.collection('mdsh-discover-content,uni-id-users,mdsh-school,mdsh-discover')\r\n\t\t\t\t\t.where({\r\n\t\t\t\t\t\tstatus: true,\r\n\t\t\t\t\t\t'uid._id': this.uid\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.field(\r\n\t\t\t\t\t\t\"content,view,common_num,images,avatar,up,down,collect_num,is_top,is_best,create_date,uid{nickName,avatar},cid{name,cover},school_id{logo,college_name},location\"\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.orderBy('create_date desc')\r\n\t\t\t\t\t.skip(skip)\r\n\t\t\t\t\t.limit(this.contList.limit)\r\n\t\t\t\t\t.get().then((res) => {\r\n\t\t\t\t\t\tconst data = res.result.data\r\n\t\t\t\t\t\tif (data.length < this.contList.limit) {\r\n\t\t\t\t\t\t\tthis.contList.load = \"noMore\"\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.contList.load = \"more\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\t\tthis.contList.list = this.contList.list.concat(data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetDiscover() {\r\n\t\t\t\tlet skip = (this.disList.page - 1) * this.disList.limit;\r\n\t\t\t\tdb.collection('mdsh-discover')\r\n\t\t\t\t\t.where({\r\n\t\t\t\t\t\tstatus: true,\r\n\t\t\t\t\t\tuid: this.uid\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.field(\r\n\t\t\t\t\t\t\"cover,name,topic_num,common_num\"\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.orderBy('common_num desc,topic_num desc')\r\n\t\t\t\t\t.skip(skip)\r\n\t\t\t\t\t.limit(this.disList.limit)\r\n\t\t\t\t\t.get().then((res) => {\r\n\t\t\t\t\t\tconst data = res.result.data\r\n\t\t\t\t\t\tif (data.length < this.disList.limit) {\r\n\t\t\t\t\t\t\tthis.disList.load = \"noMore\"\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.disList.load = \"more\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\t\tthis.disList.list = this.disList.list.concat(data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tclick(index) {\r\n\t\t\t\tif (index == 0) {\r\n\t\t\t\t\tvar that = this;\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: 1,\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tif (res.tempFilePaths.length > 0) {\r\n\t\t\t\t\t\t\t\tlet filePath = res.tempFilePaths[0]\r\n\t\t\t\t\t\t\t\tuniCloud.uploadFile({\r\n\t\t\t\t\t\t\t\t\tfilePath: filePath,\r\n\t\t\t\t\t\t\t\t\tcloudPath: 'a.jpg',\r\n\t\t\t\t\t\t\t\t\tonUploadProgress: function(progressEvent) {\r\n\t\t\t\t\t\t\t\t\t\tvar percentCompleted = Math.round(\r\n\t\t\t\t\t\t\t\t\t\t\t(progressEvent.loaded * 100) / progressEvent.total\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsuccess(suc) {\r\n\t\t\t\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: \"图片检测中\"\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\tvar images = [];\r\n\t\t\t\t\t\t\t\t\t\timages.push(suc.fileID);\r\n\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\tname: \"discover\",\r\n\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfunct: \"imgSecCheckRes\",\r\n\t\t\t\t\t\t\t\t\t\t\t\timgs: images\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).then((resb) => {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\t\t\t\tif (resb.result.data.length == 1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tdb.collection('uni-id-users')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.where('_id==$env.uid')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.update({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackgroundImage: resb.result.data[0]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).then((res) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon: \"success\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: \"修改成功\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.setUserInfo({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackgroundImage: resb.result.data[0]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: err.message ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'请求服务失败',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).finally(() => {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: resb.result.message ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'图片检测到异常',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\tcontent: err.message || '上传失败',\r\n\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tcomplete() {}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: \"../editor/editor\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetuserinfo() {\r\n\t\t\t\tvar that = this\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: \"login-by-weixin\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tfunct: \"getuserinfotoken\",\r\n\t\t\t\t\t\ttoken: uni.getStorageSync('uni_id_token')\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (res.result.code == -2) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\ttitle: res.result.message\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tthat.login()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.setStorageSync('userinfo', res.result.userInfo)\r\n\t\t\t\t\t\t\tthat.userinfo = res.result.userInfo\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\teditfriend() {\r\n\t\t\t\tif (this.userinfo) {\r\n\t\t\t\t\tif (this.friend) {\r\n\t\t\t\t\t\tdb.action(\"add-friend\")\r\n\t\t\t\t\t\t.collection('mdsh-friend')\r\n\t\t\t\t\t\t.where({\r\n\t\t\t\t\t\t\tuid: this.userinfo._id,\r\n\t\t\t\t\t\t\tfriend_id: this.uinfo._id\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.remove()\r\n\t\t\t\t\t\tthis.getfriendinfo()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdb.action(\"add-friend\")\r\n\t\t\t\t\t\t.collection('mdsh-friend')\r\n\t\t\t\t\t\t.add({\r\n\t\t\t\t\t\t\tfriend_id: this.uinfo._id\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.getfriendinfo()\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.login()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetuserinfouid() {\r\n\t\t\t\tvar that = this\r\n\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\tname: \"login-by-weixin\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tfunct: \"getuserinfouid\",\r\n\t\t\t\t\t\tuid: that.uid\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (res.result.code == -2) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\ttitle: res.result.message\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthat.uinfo = res.result.userInfo\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpostdeta(id) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"/pages/discover/detail/detail?id=\" + id\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgroupdeta(id, name) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"/pages/discover/group/group?id=\" + id + '&name=' + name\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetfriendinfo() {\r\n\t\t\t\tdb.collection('mdsh-friend')\r\n\t\t\t\t.where({\r\n\t\t\t\t\tuid: this.userinfo._id,\r\n\t\t\t\t\tfriend_id: this.uinfo._id\r\n\t\t\t\t})\r\n\t\t\t\t.get({\r\n\t\t\t\t\tgetOne: true\r\n\t\t\t\t}).then((res) => {\r\n\t\t\t\t\tconst data = res.result.data\r\n\t\t\t\t\tif(data){\r\n\t\t\t\t\t\tthis.friend = data\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.friend = ''\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t// uni.showModal({\r\n\t\t\t\t\t// \tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t// \tshowCancel: false\r\n\t\t\t\t\t// })\r\n\t\t\t\t}).finally(() => {\r\n\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tlogin() {\r\n\t\t\t\t//#ifdef MP\r\n\t\t\t\tthis.$refs.auth.showpop();\r\n\t\t\t\t//#endif\r\n\t\t\t},\r\n\t\t\tactionclick(e){\r\n\t\t\t\tvar that=this;\r\n\t\t\t\tif(that.hasLogin && that.userinfo._id==that.uid){\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t    title: '',\r\n\t\t\t\t\t    content: '确认要删除吗',\r\n\t\t\t\t\t    success: function (res) {\r\n\t\t\t\t\t        if (res.confirm) { \r\n\t\t\t\t\t            db.collection(\"mdsh-discover-content\")\r\n\t\t\t\t\t              .where({\r\n\t\t\t\t\t                _id: that.actioninfoi._id,\r\n\t\t\t\t\t\t\t\t\tuid:db.env.uid\r\n\t\t\t\t\t              })\r\n\t\t\t\t\t              .remove()\r\n\t\t\t\t\t                .then((res) => {\r\n\t\t\t\t\t                    uni.showToast({\r\n\t\t\t\t\t                        title: '删除成功'\r\n\t\t\t\t\t                    })\r\n\t\t\t\t\t\t\t\t\t\tthat.contList.load = \"loading\";\r\n\t\t\t\t\t\t\t\t\t\tthat.contList.page=1\r\n\t\t\t\t\t\t\t\t\t\tthat.contList.list=[]\r\n\t\t\t\t\t\t\t\t\t\tthat.getContent()\r\n\t\t\t\t\t                }).catch((err) => {\r\n\t\t\t\t\t                    uni.showModal({\r\n\t\t\t\t\t                        content: err.message || '删除失败',\r\n\t\t\t\t\t                        showCancel: false\r\n\t\t\t\t\t                    })\r\n\t\t\t\t\t                }).finally(() => {\r\n\t\t\t\t\t            \r\n\t\t\t\t\t                })\r\n\t\t\t\t\t        } else if (res.cancel) {\r\n\t\t\t\t\t            console.log('用户点击取消');\r\n\t\t\t\t\t        }\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon:\"none\",\r\n\t\t\t\t\t\ttitle:\"无权操作\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tshare(e){\r\n\t\t\t\tthis.actioninfoi=e\r\n\t\t\t\tthis.actionshow=true\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n"],"sourceRoot":""}